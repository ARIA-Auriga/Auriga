----------------------------------------
//0664 [2009/09/23] by Rayce

・武器研究の命中率計算が桁落ちしていた問題を修正（battle.c）
・武器研究の命中率計算のタイミングをstep3からstep2に移動（battle.c）

・ゴスペルの敵に対する呪い/暗黒/毒効果において、確率計算にはスキルユニットではなく
  ユニット所有者のベースレベルを渡すように修正（skill.c）

・skill_castend_pos() における SI_ACTIONDELAY の発生タイミングを
  skill_castend_pos2() の呼び出し前に移動（skill.c）

----------------------------------------
//0663 [2009/09/23] by Rayce

・0630以降、ジークフリードの装備耐性の効果が無かったのを修正（status.c）
・あまり意味がないので、battle_auriga.conf の「scdef_no_difflevel」は撤廃（battle.*, status.c）
・月の安楽状態に関する判定が間違っているような気がするので修正（status.c）

----------------------------------------
//0662 [2009/09/23] by Rayce

・スキル個別の仕様切り替え機能は蛇足なので、battle_auriga.conf の「whistle_perfect_flee」は撤廃
  口笛は完全回避上昇効果が無い仕様で固定化
  （battle.*, skill.c, status.c）

・PC以外の場合においても口笛に完全回避上昇を乗せないように修正する（status.c）
・SC_WHISTLE_ 状態における回避上昇計算が SC_WHISTLE を元に行われていた問題を修正（status.c）

----------------------------------------
//0661 [2009/09/23] by Rayce

・clif_status_change() を整理（clif.c）
・@icon に第3引数を追加（atcommand.c）
	アイコンのディレイ時間を指定、省略時は0と同じ

・conf/help.txt更新
・doc/client_packet.txt更新

----------------------------------------
//0660 [2009/09/23] by Rayce

・0645以降、トルリョチャギの吹き飛ばし効果がMOBが使用したときのみしか発動しないのを修正（skill.c）

・阿修羅覇王拳をShiftクリックで発動したとき、SPを0にする処理は battle_skill_attack() 内
  ではなく、呼び出し元の skill_castend_damage_id() で行う（battle.c, skill.c）

・ブランディッシュスピアをShiftクリックで発動したときのエフェクト発生処理方法を最適化（skill.c）

----------------------------------------
//0659 [2009/09/23] by Rayce

・ストームガストの3HIT目で弾かない処理をリファクタリング（battle.c）

・スキル個別の仕様切り替え機能は蛇足なので、battle_auriga.conf の「sg_type」は撤廃（battle.*, skill.c）
  11x11のユニットを1個生成するのではなく、3x3のユニットを81個生成する仕様に固定する

・ストームガストのスキルユニットのrangeを1に合わせる（db/skill_unit_db.txt）

----------------------------------------
//0658 [2009/09/23] by Rayce

・アースクェイクの計算式を一般式に変更（battle.c）
・アースクェイクに関する条件判定順序を入れ替え（battle.c）

・アースクェイクにおけるPCとMOBの判定処理を最適化（skill.c）
  以下の2つの関数は不要なので削除
	-> skill_area_sub_count_mob()
	-> skill_area_sub_count_pc()

・0655において、pkmap_noteleportの記述を除去抜けがあり
  コンパイルできなかった問題を修正（skill.c）

----------------------------------------
//0657 [2009/09/23] by Rayce

・pointshopは <point> に負数を指定しても値の補正をしないように0623以前の仕様に戻す（npc.c）
・pointshopは価格設定の「:」を省略できないように強化（npc.c）
・ショップのアイテムIDと価格の書式が間違っている場合、エラーを出力するように強化（npc.c）

----------------------------------------
//0656 [2009/09/23] by Rayce

・MAX_MOBSKILLは 64 だと大きすぎるので 48 に引き下げ（map.h）
・MOBが待機時のスキル使用を失敗したとき、return で終了せずに歩行処理を続行する（mob.c）
・unit_data構造体に追加された idlecount メンバをmob_data構造体に変更（map.h, mob.c）

----------------------------------------
//0655 [2009/09/23] by Rayce

・battle_auriga.conf の「pkmap_noteleport」を撤廃
  代わりに map_auriga.conf の「map_pk_noteleport」で全てのPKマップに対して
  一括でMAPフラグ noteleport を設定するようにする（battle.*, map.c）

・battle_auriga.conf の初期値を変更（battle.c）
	monster_skill_over = 10
	NULL = 0

----------------------------------------
//0654 [2009/09/23] by Rayce

・出来る限り BL_CHAR マクロを利用するように置き換え（battle.c, mob.c, skill.c）
・battle_calc_damage() におけるGvG補正処理を最適化（battle.c）
・演算子の優先順序が間違っている可能性があるので修正（npc.c）

----------------------------------------
//0653 [2009/09/22] by Rayce

・GvGで城主が交代したとき、ワープ中でブロックリストから外れたPCが砦外に退去できない
  問題に関する対処（battle.*, script.c）
	based on eA, thanks a lot!!

	-> buildin_maprespawnguildid() を書き換え
	   PC用の検索ルーチン buildin_maprespawnguildid_sub_pc() と、
	   MOB用の検索ルーチン buildin_maprespawnguildid_sub_mob() の2つに分離
	-> battle_auriga.conf に「maprespawnguildid_all_players」を追加
	   デフォルトは本鯖と同じ「no」
	   「yes」にするとワープ中のPCも砦外に退去させる

----------------------------------------
//0652 [2009/09/22] by Rayce

・battle_auriga.conf の「pvp_send_guild_xy」の判定は、clif_guild_xy() 内ではなく
  呼び出し元の guild_send_xy_timer_sub() で行うように変更（clif.c, guild.c）

・guild_castlealldataload() のリファクタリング（guild.c）

----------------------------------------
//0651 [2009/09/22] by Rayce

・砦で MobId: 1285〜1288 のモンスターを呼び出すと、常にギルド所属扱いになるのを撤廃（mob.c）

・NPCスクリプトの getguardianinfo 関数で、indexに1〜8以外を指定すると
  バッファオーバーフロー/アンダーフローが発生するのを修正（script.c）

----------------------------------------
//0650 [2009/09/22] by Rayce

・各砦に設定可能なガーディアンの数は、MAX_GUILDGUARDIAN ではなく直接「8」で指定する
  （mmo.h, mob.c, script.c）

	※セーブデータはガーディアンの数を「8」であることを前提として処理を行っているため、
	  MAX_GUILDGUARDIAN を「8」以外の任意の数に変更してしまうとサーバクラッシュする。
	  可変に設定できないことを明示するために、配列の数を「8」で固定化する。

・砦情報を高速に取得するために guild_mapid2gc() を追加（mmo.h, guild.*）

	※guild_mapname2gc() はMAP名を文字列比較で検索するため低速です。
	  そのため、MAP番号を用いて高速に検索を行える guild_mapid2gc() を追加しました。
	  ただし、同一MAPサーバであることが確定している場合のみ使用可能です。
	  他のMAPサーバが管理しているMAPについては検索できないので注意してください。

・NPCスクリプトの callguardian 命令で、複数体のガーディアンを呼び出すと
  最後の1体しか砦所属にならない問題を修正（script.c）
・guild_mapname2gc の引数をconstにする（guild.*）

----------------------------------------
//0649 [2009/09/22] by Rayce

・sc_startおよびsc_starte命令において、完全耐性の場合でも状態異常に掛かる問題をを修正（script.c）
・getscrate命令は status_change_rate() の結果をそのまま返すように修正（script.c）
  引数の <percentage> と戻り値を百分率から万分率に変更

・doc/script_ref.txtを修正

----------------------------------------
//0648 [2009/09/22] by Rayce

・カプラのカートサービスにおいて、職業コードが数値指定に巻き戻っていたので修正
  （script/npc/misc/npc_misc_kafra.txt）

・細かい整形（db/packet_db.txt, db/scdata_db.txt）

----------------------------------------
//0647 [2009/09/22] by Rayce

・サーバースナップショット（version.h）
